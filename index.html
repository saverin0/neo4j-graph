<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Graph Explorer</title>

<!-- Cytoscape -->
<script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at top, #0d1630, #030712);
  font-family: Arial, sans-serif;
  color: white;
}

#toolbar {
  position: fixed;
  top: 12px;
  left: 12px;
  z-index: 10;
  background: rgba(15,20,40,0.9);
  border-radius: 12px;
  padding: 10px 14px;
  display: flex;
  gap: 10px;
  align-items: center;
  box-shadow: 0 0 20px rgba(0,200,255,0.2);
}

button {
  background: #141b33;
  border: 1px solid #2b3a7a;
  color: white;
  border-radius: 8px;
  padding: 6px 12px;
  cursor: pointer;
}

button:hover {
  background: #1e2a55;
}

#cy {
  width: 100%;
  height: 100%;
}
</style>
</head>

<body>

<div id="toolbar">
  ⚡ Graph Explorer
  <button onclick="resetView()">Home</button>
  <button onclick="showAll()">Show all</button>
  <span style="font-size:12px;color:#aaa">
    Hover = focus · Drag = move
  </span>
</div>

<div id="cy"></div>

<script>

const cy = cytoscape({
  container: document.getElementById("cy"),

  style: [

    {
      selector: "node",
      style: {
        "background-color": "#5fa9ff",
        "label": "data(labelText)",
        "color": "#ffffff",
        "font-size": "10px",
        "text-outline-color": "#000",
        "text-outline-width": 2,
        "text-valign": "center",
        "text-halign": "center",
        "width": 22,
        "height": 22
      }
    },

    {
      selector: "edge",
      style: {
        "line-color": "#aaa",
        "target-arrow-color": "#aaa",
        "target-arrow-shape": "triangle",
        "curve-style": "bezier",
        "width": 1
      }
    },

    {
      selector: ".faded",
      style: {
        "opacity": 0.08
      }
    }

  ]
});


// --------------------
// Load graph.json
// --------------------

fetch("graph.json")
.then(res => res.json())
.then(data => {

  // IMPORTANT FIX (your structure is nested)
  const elements = data[0].json.elements;

  const nodes = [];
  const edges = [];

  // ---------- NODES ----------
  elements.nodes.forEach(n => {

    const props = n.data;
    const label = n.data.labels[0];

    let labelText =
      props.partners ||
      props.deliverables_no ||
      props.valuechain_name ||
      props.value_chains ||
      props.demonstrations ||
      props.innovations_name ||
      props.phase_id ||
      n.data.id;

    nodes.push({
      data: {
        id: n.data.id,
        label: label,
        labelText: labelText,
        ...props
      }
    });

  });

  // ---------- RELATIONSHIPS ----------
  elements.relationships.forEach(r => {

    edges.push({
      data: {
        id: r.data.id,
        source: r.data.startNode,
        target: r.data.endNode,
        label: r.data.type
      }
    });

  });

  cy.add([...nodes, ...edges]);

  // Nice force layout
  cy.layout({
    name: "cose",
    animate: true,
    gravity: 0.6,
    idealEdgeLength: 90,
    nodeOverlap: 15,
    padding: 50
  }).run();

});


// --------------------
// Hover focus effect
// --------------------

cy.on("mouseover", "node", function(evt){
  const node = evt.target;
  cy.elements().addClass("faded");
  node.removeClass("faded");
  node.connectedEdges().removeClass("faded");
  node.connectedEdges().connectedNodes().removeClass("faded");
});

cy.on("mouseout", "node", function(){
  cy.elements().removeClass("faded");
});


// --------------------
// Buttons
// --------------------

function resetView() {
  cy.fit();
}

function showAll() {
  cy.elements().removeClass("faded");
  cy.fit();
}

</script>

</body>
</html>
