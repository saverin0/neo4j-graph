<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Graph Explorer</title>
  <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>

  <style>
    html, body { width:100%; height:100%; margin:0; font-family: Arial, sans-serif; background:#070A12; }
    #app { display:flex; width:100%; height:100%; }
    #cy {
      flex: 1; height: 100%; position: relative;
      background: radial-gradient(circle at 30% 20%, #0b1230 0%, #070A12 45%, #050711 100%);
      overflow: hidden;
    }
    #cy::before{
      content:""; position:absolute; inset:0; pointer-events:none; z-index:0;
      background:
        radial-gradient(circle at 15% 25%, rgba(0,229,255,.10) 0%, transparent 52%),
        radial-gradient(circle at 85% 30%, rgba(255,43,214,.09) 0%, transparent 52%),
        radial-gradient(circle at 60% 85%, rgba(155,255,58,.08) 0%, transparent 55%),
        radial-gradient(circle at 30% 80%, rgba(255,211,74,.06) 0%, transparent 58%),
        radial-gradient(circle at 80% 75%, rgba(255,122,0,.06) 0%, transparent 58%);
      filter: blur(2px);
      animation: drift 12s ease-in-out infinite alternate;
    }
    #cy > canvas { position:relative; z-index:1; }
    @keyframes drift { from { transform: translate3d(-5px,-3px,0) scale(1.01); } to { transform: translate3d(6px,5px,0) scale(1.03); } }

    #side {
      width: 360px; border-left: 1px solid rgba(255,255,255,0.08);
      padding: 12px; box-sizing: border-box; overflow: auto;
      background: linear-gradient(180deg, rgba(15,18,34,0.98), rgba(8,10,18,0.98));
      color: #E9ECFF;
    }
    #toolbar {
      position: fixed; top: 12px; left: 12px; z-index: 999;
      background: rgba(10,12,22,0.85);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.45);
      padding: 10px 12px;
      display: flex; gap: 8px; align-items: center;
      backdrop-filter: blur(8px);
      color: #E9ECFF;
      max-width: 980px;
    }
    .btn {
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: #E9ECFF;
      padding: 7px 10px;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
    }
    .btn:hover { background: rgba(255,255,255,0.12); }
    #search {
      width: 280px; padding: 8px 10px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: #E9ECFF; outline: none;
    }
    #search::placeholder { color: rgba(233,236,255,0.6); }
    h3 { margin: 8px 0 10px; }
    .muted { color: rgba(233,236,255,0.65); font-size: 12px; line-height: 1.4; }
    .kv { margin: 10px 0; }
    .k { font-size: 12px; color: rgba(233,236,255,0.65); }
    .v { font-size: 13px; word-break: break-word; color: #E9ECFF; }
    code { background: rgba(255,255,255,0.08); padding: 1px 6px; border-radius: 6px; }
    hr { border: 0; border-top: 1px solid rgba(255,255,255,0.10); margin: 10px 0; }
  </style>
</head>

<body>

<div id="toolbar">
  <div style="font-weight:700;">⚡ Graph Explorer</div>
  <div class="btn" id="btnHome">Home</div>
  <div class="btn" id="btnShowAll">Show all</div>
  <input id="search" placeholder="Search (any property), press Enter" />
  <div class="muted">Hover = focus • Single click = details • Double click = expand</div>
</div>

<div id="app">
  <div id="cy"></div>
  <div id="side">
    <h3>Details</h3>
    <div id="details" class="muted">Home shows 5 hubs. Double click one hub to open that category.</div>
    <hr />
    <div class="muted">Tip: Hover a node to reduce clutter.</div>
  </div>
</div>

<script>

const COLORS = {
  Material: "#00E5FF",
  ValueChainStage: "#4CC9FF",
  Partner: "#FF2BD6",
  Deliverable: "#9BFF3A",
  Demonstration: "#FFD34A",
  Innovation: "#FF7A00",
  Other: "#A3A9FF"
};

const HUB_COLORS = {
  Material: "#4CC9FF",
  ValueChainStage: "#3DB4FF",
  Partner: "#FF4DE1",
  Deliverable: "#B4FF4A",
  Demonstration: "#FFE06A",
  Innovation: "#FF9A3C"
};

const HUBS = [
  { id: "HUB_MATERIAL", label: "Material", title: "Materials" },
  { id: "HUB_STAGE", label: "ValueChainStage", title: "Value Chain Stages" },
  { id: "HUB_PARTNER", label: "Partner", title: "Partners" },
  { id: "HUB_DELIV", label: "Deliverable", title: "Deliverables" },
  { id: "HUB_DEMO", label: "Demonstration", title: "Demonstrations" },
  { id: "HUB_INNO", label: "Innovation", title: "Innovations" }
];

let cy;

function unwrapNeo4jBrowserJson(raw) {
  if (Array.isArray(raw) && raw[0] && raw[0].json && raw[0].json.elements) return raw[0].json.elements;
  return raw?.elements ?? null;
}

function asNiceText(v) {
  if (v == null) return "";
  if (Array.isArray(v)) return v.filter(Boolean).join(" • ");
  if (typeof v === "object") return JSON.stringify(v);
  return String(v);
}

function pickNodeLabel(d) {
  const label = (d.labels && d.labels[0]) || "Other";

  if (label === "Material") return asNiceText(d.material_name) || asNiceText(d.material) || asNiceText(d.id);
  if (label === "ValueChainStage") return asNiceText(d.stage_name) || asNiceText(d.phase_id) || asNiceText(d.id);
  if (label === "Partner") return asNiceText(d.partners) || asNiceText(d.partners_legalname) || asNiceText(d.id);
  if (label === "Deliverable") return asNiceText(d.deliverables_no) || asNiceText(d.deliverables_name) || asNiceText(d.id);
  if (label === "Demonstration") return asNiceText(d.demonstrations) || asNiceText(d.demonstrations_type) || asNiceText(d.id);
  if (label === "Innovation") return asNiceText(d.innovations_name) || asNiceText(d.innovations) || asNiceText(d.id);

  return asNiceText(d.id);
}

function sizeForLabel(label) {
  if (label === "Material") return 24;
  if (label === "ValueChainStage") return 23;
  if (label === "Partner") return 24;
  if (label === "Deliverable") return 22;
  if (label === "Demonstration") return 21;
  if (label === "Innovation") return 21;
  return 16;
}

function colorForLabel(label) { return COLORS[label] || COLORS.Other; }

function hubIdFor(label) {
  if (label === "Material") return "HUB_MATERIAL";
  if (label === "ValueChainStage") return "HUB_STAGE";
  if (label === "Partner") return "HUB_PARTNER";
  if (label === "Deliverable") return "HUB_DELIV";
  if (label === "Demonstration") return "HUB_DEMO";
  if (label === "Innovation") return "HUB_INNO";
  return null;
}

// EVERYTHING ELSE REMAINS UNCHANGED BELOW (your working logic)

</script>

</body>
</html>
